async function getRiwayatCuti(tahun){return await $.ajax({url:"/api/cuti/approvementcuti?tahun="+tahun,method:"GET",success:function(response){return parsingDataCuti(response.data),response.data},error:function(error){}})}function parsingDataCuti(data){$("tbody > tr").remove();for(let i of data){let tanggalmulai,tanggalsampai,nomor=data.indexOf(i)+1;tanggalmulai=null==i.data_cuti.mulai||"0000-00-00"==i.data_cuti.mulai?"-":new Date(i.data_cuti.mulai).toLocaleDateString("id-ID",{day:"numeric",month:"numeric",year:"numeric"}),tanggalsampai=null==i.data_cuti.samapi||"0000-00-00"==i.data_cuti.samapi?"-":new Date(i.data_cuti.samapi).toLocaleDateString("id-ID",{day:"numeric",month:"numeric",year:"numeric"});let approve_status="";if(null==i.approve_date)approve_status="Belum di Approve";else{approve_status=new Date(i.approve_date).toLocaleString("en-US",{timeZone:"Asia/Jakarta"})}null==i.keterangan&&(i.keterangan="-");let row=$("<tr>");row.append($("<td>"+nomor+"</td>")),row.append($("<td>"+i.data_cuti.user.nama+"</td>")),row.append($("<td>"+tanggalmulai+" s/d "+tanggalsampai+"</td>")),row.append($("<td>"+i.data_cuti.jenis_cuti.type_cuti+"</td>")),row.append($("<td>"+i.data_cuti.jumlah+"</td>")),row.append($("<td>"+i.data_cuti.keterangan+"</td>")),row.append($("<td style='vertical-align: inherit'>"+i.alamat+"</td>")),row.append($("<td>"+i.status+"</td>")),row.append($("<td>"+approve_status+"</td>")),"Menunggu"==i.status?row.append($(`<td><button type="button" class="btn  btn-outline-primary" onclick="preview(${i.id_cuti},'${i.data_cuti.user.nama}')"><i class="fa-solid fa-signature"></i>Preview</button></td > `)):row.append($("<td>Sudah</td>")),row.append($("<td>"+i.keterangan+"</td>")),$("tbody").append(row)}}async function preview(id,nama){modalTemp(id,nama),$("#templateModal").modal("show")}function modalTemp(id,nama){templateModalLabel.innerHTML="Preview Cuti : "+nama;let body=$("#body");body.empty(),body.append(`\n        <div class="container">\n          <div class="card-body text-center">\n            <h4 class="card-title-center ">Apkah anda menyetujui cuti ini?</h4>\n            <p class="card-text">Berikan catatan jika diperlukan</p>\n            <input type="text" class="form-control" id="catatan" placeholder="Catatan">\n            <br>\n            <button type="button" class="btn btn-primary" onclick="setuju(${id})">Setuju</button>\n            <button type="button" class="btn btn-danger" onclick="tolak(${id})">Tolak</button>\n          </div>\n        </div>\n        `)}async function setuju(id){let data={id:id,status:"Disetujui",keterangan:$("#catatan").val()};await updateCuti(data),Swal.fire("SIP","Terima kasih telah menyetujui cuti ini.","success"),$("#templateModal").modal("hide"),getRiwayatCuti($("#tahun").val())}async function tolak(id){let data={id:id,status:"Ditolak",keterangan:$("#catatan").val()};await updateCuti(data),Swal.fire("Terimakasih","Cuti tidak disetujui dan di batalkan","warning"),$("#templateModal").modal("hide"),getRiwayatCuti($("#tahun").val())}async function updateCuti(data){await $.ajax({url:"/api/cuti/approvementcuti",method:"POST",data:data,success:function(response){return response.data},error:function(error){Swal.fire(error.responseJSON.message,error.responseJSON.data,"error")}})}$(document).ready((function(){getRiwayatCuti($("#tahun").val())})),$("#tahun").change((function(){let tahun=$(this).val();$("tbody > tr").remove(),getRiwayatCuti(tahun)}));
