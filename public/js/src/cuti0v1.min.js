let hariKerja = ""; $.ajax({ url: "/api/getBiodata", method: "GET", success: function (response) { hariKerja = response.data.jns_kerja }, error: function (error) { Swal.fire({ icon: "error", title: "Oops...", text: "Lengkapi biodata anda terlebih dahulu", toast: !0, confirmButtonText: "OK", confirmButtonColor: "#3085d6", allowOutsideClick: !1, allowEscapeKey: !1, allowEnterKey: !0 }).then((result => { result.isConfirmed && (window.location.href = "/profile") })) } }); let totalCuti = 0, maxCuti = 0, dataCuti = [], mulaicuti = moment().format("YYYY-MM-DD"), akhircuti = moment().format("YYYY-MM-DD"); async function sisaCuti(id_cuti) { return $.ajax({ url: "/api/cuti/sisa?type_cuti=" + id_cuti, method: "GET", success: function (response) { return response.data }, error: function (error) { } }) } $.ajax({ url: "/api/cuti/jns", method: "GET", success: function (response) { dataCuti = response.data, response.data.forEach((element => { $("#jnsCuti").append(`<option value="${element.id}">${element.type_cuti}</option>`) })) }, error: function (error) { } }), $("#jnsCuti").change((async function () { $("#reservation").prop("disabled", !1); let mindate, id = $(this).val(), jnsCuti = dataCuti.find((x => x.id == id)), x = await sisaCuti(jnsCuti.id); $("#Keterangan_cuti").text(jnsCuti.type_cuti + " maksimal " + jnsCuti.max + " hari secara berturut-turut dan maksimal " + jnsCuti.total + " hari dalam setahun. Sisa cuti anda " + x.data.sisa_cuti + " hari"), $("#reservation").val(""), $("#totalReservation").val("1"), "Cuti Sakit" == jnsCuti.type_cuti || "Cuti Melahirkan" == jnsCuti.type_cuti ? (mindate = moment().subtract(1, "weeks").startOf("day"), $("#lampiran").empty(), $("#lampiran").append(`<label for="InputActivities">Lampiran Surat ${jnsCuti.type_cuti}</label>\n                        <input type="hidden" class="form-control" id="suratLampiran" name="suratLampiran">\n                        <div class="input-group mb-3">\n                          <input type="file" class="form-control" id="inputSuratCuti" name="inputSuratCuti" accept="image/png, image/jpeg, application/pdf">\n                          <label class="input-group-text" for="inputSuratCuti" id="UploadSuratCuti">Upload</label>\n                        </div>`)) : (mindate = moment().subtract(1, "days").startOf("day"), $("#lampiran").empty()), $("#reservation").daterangepicker({ minDate: mindate, maxDate: moment("2025-12-31", "YYYY-MM-DD"), singleDatePicker: !1, autoApply: !1, autoUpdateInput: !0, locale: { format: "DD/MM/YYYY", daysOfWeek: ["Min", "Sen", "Sel", "Rab", "Kam", "Jum", "Sab"], monthNames: ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"], firstDay: 1, applyLabel: "Pilih", cancelLabel: "Batal", customRangeLabel: "Pilih Tanggal" } }, (function (start, end) { mulaicuti = start.format("YYYY-MM-DD"); const tanggalAwal = moment(start, "YYYY-MM-DD"); akhircuti = end.format("YYYY-MM-DD"); const selisihHari = moment(end, "YYYY-MM-DD").diff(tanggalAwal, "days") + 1; if (selisihHari > jnsCuti.max) return Swal.fire({ icon: "error", title: "Oops...", text: `Cuti tidak boleh lebih dari ${jnsCuti.max} hari` }), $("#reservation").val(""), $("#totalReservation").val(""), !1; "5 Hari kerja" == hariKerja && $("#totalReservation").prop("disabled", !1), $("#totalReservation").val(selisihHari) })) })); let token = getCookie("token"); function postCuti(datafrom) { $.ajax({ url: "/api/cuti", method: "POST", data: datafrom, success: function (response) { Swal.fire({ icon: "success", title: "Succeed", text: "Cuti berhasil disimpan", showConfirmButton: !1, timer: 2e3 }), $("#jnsCuti").val(""), $("#reservation").val(""), $("#totalReservation").val(""), $("#reservation").prop("disabled", !1), $("#totalReservation").prop("disabled", !1), $("#alasanCuti").val(""), $("#alamat").val(""), getRiwayatCuti($("#tahun").val()), $("#btnSubmit").prop("disabled", !1) }, error: function (error) { Swal.fire({ icon: error.responseJSON.icon, title: error.responseJSON.message, text: error.responseJSON.data, showConfirmButton: !1, timer: 2e3 }), $("#btnSubmit").prop("disabled", !1) } }) } async function getRiwayatCuti(tahun) { return await $.ajax({ url: "/api/cuti/riwayat?tahun=" + tahun, method: "GET", success: function (response) { return parsingDataCuti(response.data), response.data }, error: function (error) { } }) } function parsingDataCuti(data) { $("tbody > tr").remove(); for (let i of data) { let tanggalmulai, tanggalsampai, nomor = data.indexOf(i) + 1; tanggalmulai = null == i.mulai || "0000-00-00" == i.mulai ? "-" : new Date(i.mulai).toLocaleDateString("id-ID", { day: "numeric", month: "long", year: "numeric" }), tanggalsampai = null == i.samapi || "0000-00-00" == i.samapi ? "-" : new Date(i.samapi).toLocaleDateString("id-ID", { day: "numeric", month: "long", year: "numeric" }); let tglApproval = new Date(i.approval.approve_date).toLocaleDateString("id-ID", { day: "numeric", month: "long", year: "numeric" }), waktuApproval = new Date(i.approval.approve_date).toLocaleTimeString("id-ID"); null === i.approval.approve_date ? i.approval.approve_date = "-" : i.approval.approve_date = tglApproval + " " + waktuApproval, null === i.approval.atasan && (i.approval.atasan.nama = "-"); let row = $("<tr>"); row.append($("<td>" + nomor + "</td>")), row.append($("<td>" + tanggalmulai + " - " + tanggalsampai + "</td>")), row.append($("<td>" + i.jenis_cuti.type_cuti + "</td>")), row.append($("<td>" + i.jumlah + "</td>")), row.append($("<td>" + i.keterangan + "</td>")), row.append($("<td>" + i.approval.status + "</td>")), row.append($("<td>" + i.approval.approve_date + "</td>")), row.append($("<td>" + i.approval.atasan.nama + "</td>")), row.append($("<td>" + i.approval.keterangan + "</td>")); let btnDelete = $("<button>"); btnDelete.addClass("btn btn-danger btn-sm"), btnDelete.attr("onclick", "deleteCuti(" + i.id + ")"), btnDelete.html("<i class='fas fa-trash'></i> Batalkan"); let btnCetak = $("<button>"); btnCetak.addClass("btn btn-primary btn-sm"), btnCetak.attr("onclick", "cetakSuratCuti(" + i.id + ")"), btnCetak.html("<i class='fa-solid fa-envelope-open-text'></i> Cetak Surat Cuti"), "Menunggu" == i.approval.status ? row.append($("<td>").append(btnCetak, btnDelete)) : "Disetujui" != i.approval.status && "Ditolak" != i.approval.status && "Perubahan" != i.approval.status || row.append($("<td>").append(btnCetak)), $("tbody").append(row) } } $("#Cuti").submit((function (event) { event.preventDefault(), $("#btnSubmit").prop("disabled", !0); let datafrom = { type_cuti: $("#jnsCuti").val(), mulai: mulaicuti, samapi: akhircuti, jumlah: $("#totalReservation").val(), keterangan: $("#alasanCuti").val(), maxCuti: maxCuti, alamat: $("#alamat").val() }, id = $("#jnsCuti").val(), jnsCuti = dataCuti.find((x => x.id == id)); if ("Cuti Sakit" == jnsCuti.type_cuti || "Cuti Melahirkan" == jnsCuti.type_cuti) { if (null == $("#inputSuratCuti").prop("files")[0]) return Swal.fire({ icon: "error", title: "Oops...", text: "Lampiran surat harus diisi" }), !1; let file = $("#inputSuratCuti").prop("files")[0]; if ("application/pdf" !== file.type && "image/jpeg" !== file.type && "image/png" !== file.type && "image/jpg" !== file.type) return Swal.fire({ icon: "warning", title: "File Tidak Valid.", text: "File harus berupa PDF, JPG, PNG" }), !1; if (file.size > 3e6) return Swal.fire({ icon: "warning", title: "File Terlalu Besar.", text: "File harus kurang dari 3 MB" }), !1; if ("application/pdf" == file.type) { var form = new FormData; form.append("file", file, "surat-cuti.pdf"); var settings = { url: "https://api.rsudaa.singkawangkota.go.id/api/cdn/upload/file", method: "POST", timeout: 0, headers: { Authorization: "Bearer " + token }, processData: !1, mimeType: "multipart/form-data", contentType: !1, data: form }; $.ajax(settings).done((function (response) { response = JSON.parse(response), datafrom.lampiran = response.data.url, postCuti(datafrom), inputSuratCuti.value = null })) } if ("image/jpeg" == file.type || "image/png" == file.type || "image/jpg" == file.type) { let fileType = file.type.split("/")[1], form = new FormData; form.append("image", file, "surat-cuti." + fileType); let settings = { url: "https://api.rsudaa.singkawangkota.go.id/api/cdn/upload/img", method: "POST", timeout: 0, headers: { Authorization: "Bearer " + token }, processData: !1, mimeType: "multipart/form-data", contentType: !1, data: form }; $.ajax(settings).done((function (response) { response = JSON.parse(response), datafrom.lampiran = response.data.url, postCuti(datafrom), inputSuratCuti.value = null })) } } else postCuti(datafrom) })), $(document).ready((function () { getRiwayatCuti($("#tahun").val()) })), $("#tahun").change((function () { let tahun = $(this).val(); $("tbody > tr").remove(), getRiwayatCuti(tahun) })), cetakSuratCuti = id => { $.ajax({ url: "/api/cuti/suratCuti", method: "POST", data: { id: id }, success: function (response) { window.open("/api/cuti/suratCuti?token=" + response.data, "_blank") } }) }, deleteCuti = id => { Swal.fire({ title: "Apakah anda yakin?", text: "Data cuti akan dihapus", icon: "warning", showCancelButton: !0, confirmButtonColor: "#3085d6", cancelButtonColor: "#6c757d", confirmButtonText: "Ya, hapus data!" }).then((result => { result.isConfirmed && $.ajax({ url: "/api/cuti?id=" + id, method: "DELETE", success: function (response) { Swal.fire({ icon: "success", title: "Succeed", text: "Data berhasil dihapus", showConfirmButton: !1, timer: 2e3 }), getRiwayatCuti($("#tahun").val()) }, error: function (error) { Swal.fire({ icon: error.responseJSON.icon, title: error.responseJSON.message, text: error.responseJSON.data, showConfirmButton: !1, timer: 2e3 }) } }) })) };