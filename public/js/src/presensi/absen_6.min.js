function updateClock(){let date=new Date,t=date.toLocaleTimeString(),dayName=["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"],monthName=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],year=date.toLocaleDateString("id-ID",{year:"numeric"}),dayNumber=date.toLocaleDateString("id-ID",{day:"numeric"});date.toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"});$("#day").text(dayName[date.getDay()]),$("#month").text(monthName[date.getMonth()]),$("#year").text(year),$("#dayNumber").text(dayNumber),$("#time").text(t),$("#date").text(dayName[date.getDay()]+", "+dayNumber+" "+monthName[date.getMonth()]+" "+year)}setInterval(updateClock,1e3);let lastPosition=null;if(navigator.geolocation.watchPosition((position=>{if(lastPosition){calculateDistance(lastPosition.latitude,lastPosition.longitude,position.coords.latitude,position.coords.longitude)/((position.timestamp-lastPosition.timestamp)/1e3/3600)>150?($("#posisi").text("Kemungkinan fake GPS terdeteksi."),geoIn=void 0,geoOut=void 0):(geoIn=`${position.coords.latitude},${position.coords.longitude}`,geoOut=`${position.coords.latitude},${position.coords.longitude}`,$.ajax({url:"/api/presensi/getlocation",method:"POST",data:{latitude:position.coords.latitude,longitude:position.coords.longitude},success:function(response){$("#posisi").text(response.data.location),loactionIn=response.data.location,response.data.status?posisi=1:posisi=0},error:function(error){posisi=!1}}))}lastPosition={latitude:position.coords.latitude,longitude:position.coords.longitude,timestamp:position.timestamp}}),(error=>{$("#posisi").text("GPS tidak di aktifkan"),posisi=!1,Swal.fire({icon:"error",title:"Oops...",text:"Mohon aktifkan lokasi anda",buttons:!1,confirmButtonText:"OK",showCancelButton:!1,confirmButtonColor:"#3085d6",allowOutsideClick:!1,allowEscapeKey:!1,allowEnterKey:!1,confirmButtonText:`<a href="https://api.whatsapp.com/send?phone=62895321701798&text=Bagaimana%20cara%20aktifkan%20lokasi%20GPS%20saya%20${idData.nama}" class="text-white">OK</a>`})}),(options=>{options.enableHighAccuracy=!0,options.timeout=5e3,options.maximumAge=0})),navigator.geolocation){function success(position){geoIn=`${position.coords.latitude},${position.coords.longitude}`,geoOut=`${position.coords.latitude},${position.coords.longitude}`,$.ajax({url:"/api/presensi/getlocation",method:"POST",data:{latitude:position.coords.latitude,longitude:position.coords.longitude},success:function(response){$("#posisi").text(response.data.location),loactionIn=response.data.location,response.data.status?posisi=1:posisi=0},error:function(error){posisi=!1}})}function error(err){}$("#posisi").text("Loading...");let options={enableHighAccuracy:!1,timeout:5e3,maximumAge:0};navigator.geolocation.getCurrentPosition(success,error,options)}else $("#posisi").text("Perangakat tidak mendukung geolocation");function calculateDistance(lat1,lon1,lat2,lon2){const dLat=(lat2-lat1)*Math.PI/180,dLon=(lon2-lon1)*Math.PI/180,a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)*Math.sin(dLon/2);return 6371*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))}async function getStatus(){try{const battery=await navigator.getBattery();$("#baterai").text(Math.round(100*battery.level)+"%"),battery.level<.5?$("#bateraiicon").attr("class","fa-solid fa-battery-quarter"):battery.level<.8?$("#bateraiicon").attr("class","fa-solid fa-battery-half"):$("#bateraiicon").attr("class","fa-solid fa-battery-three-quarters"),battery.charging?$("#bateraichager").attr("class","fa-solid fa-bolt"):$("#bateraiicon").attr("class","fa-solid fa-battery-three-quarters")}catch(error){}}async function pingLocalDevice(ip){const startTime=Date.now();wifi=0;try{if((await fetch(`https://${ip}`,{method:"GET",cache:"no-cache",signal:AbortSignal.timeout(2e3)})).ok){Date.now();$("#wifi").text("Dalam Jaringan"),wifi=1}else $("#wifi").text("Diluar Jaringan"),wifi=0}catch(error){$("#wifi").text("Diluar Jaringan"),wifi=0}setTimeout((()=>{pingLocalDevice("api.rsudaa.singkawangkota.go.id/ping")}),1e4)}function getLocalIP(callback){const pc=new RTCPeerConnection;pc.createDataChannel(""),pc.createOffer().then((offer=>pc.setLocalDescription(offer))).catch((()=>{})),pc.onicecandidate=event=>{if(!event||!event.candidate)return;const ip=event.candidate.candidate.match(/(?:[0-9]{1,3}\.){3}[0-9]{1,3}/);ip&&callback(ip[0]),pc.close()}}getStatus(),pingLocalDevice("api.rsudaa.singkawangkota.go.id/ping"),getLocalIP((ip=>{}));
