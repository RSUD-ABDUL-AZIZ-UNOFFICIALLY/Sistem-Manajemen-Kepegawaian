const allCookies = document.cookie;

function checkCookie(t) {
    const e = document.cookie.split(";");
    for (const o of e) if (o.trim().startsWith(t + "=")) return !0;
    return !1;
}

const cookieName = "status";
const cookieExists = checkCookie("status");

if (cookieExists) {
    const t = document.cookie.split("; ").find((t => t.startsWith("status"))).split("=")[1], e = decodeURIComponent(t), o = window.atob(e), a = JSON.parse(o);
    "/profile" != window.location.pathname && Swal.fire({
        icon: a.status,
        title: a.title,
        text: a.pesan,
        confirmButtonText: "OK",
        showCancelButton: !0,
        confirmButtonColor: "#3085d6"
    }).then((t => {
        t.isConfirmed && (window.location.href = a.url);
    }));
}

async function tracker() {
    let t = "";
    try {
        t = await navigator.getBattery();
    } catch (t) {
        console.log(t);
    }
    let e = await getIP();
    $.ajax({
        url: "/api/tracker",
        method: "POST",
        data: {
            userAgent: navigator.userAgent,
            vendor: navigator.vendor,
            os: navigator.platform,
            ip: e.ip,
            as: e.asn,
            isp: e.org,
            city: e.city,
            batteryLevel: t.level
        },
        success: function(t) {}
    });
}

function getIP() {
    return $.ajax({
        url: "https://ipapi.co/json",
        method: "GET",
        success: function(t) {}
    });
}

const cookieTracker = checkCookie("tracker");

cookieTracker || (document.cookie = "tracker=true; max-age=120; path=/", tracker());

const cookieToken = checkCookie("profile");

if (cookieToken) {
    let t = document.cookie.split("; ").find((t => t.startsWith("profile"))).split("=")[1], e = decodeURIComponent(t), o = window.atob(e), a = JSON.parse(o);
    imgUser = document.getElementById("imgUser"), imgUser.src = a.url;
}

async function setOnline() {
    let id = sessionStorage.getItem("dataIDUser");
    let name = sessionStorage.getItem("dataIDname");
    if (id == null && name == null) {
     await $.ajax({
                url: "/api/jwt",
                method: "post",
                success: function(t) {
                    id = t.data.id;
                    name = t.data.nama;
                    sessionStorage.setItem("dataIDUser", t.data.id), sessionStorage.setItem("dataIDname", t.data.nama);
                }
            })
    }
    return $.ajax({
      url: "https://cdn.spairum.biz.id/api/ls/update/lpkp?id=" + id + "&name=" + name,
      method: "GET",
    });
  }
  setInterval(setOnline, 5e3)