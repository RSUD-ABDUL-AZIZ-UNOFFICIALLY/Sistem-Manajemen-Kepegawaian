async function profilepic() {
  const img = sessionStorage.getItem("img");
  if (img == null) {
    await $.ajax({
      url: "/api/getPic",
      method: "GET",
      success: function (data) {
        if (data) {
          sessionStorage.setItem("img", data.data.url);
          $("#imgUser").attr("src", data.data.url);
        }
      },
      error: function (err) {
        console.log(err);
      }
    });
  } else {
    $("#imgUser").attr("src", img);
  }

}
profilepic();

function queryselec() {
  const currentLocation = location.href;
  const menuItem = document.querySelectorAll(".nav-link");
  const menuLength = menuItem.length;
  for (let i = 0; i < menuLength; i++) {
    if (menuItem[i].href === currentLocation) {
      menuItem[i].className = "nav-link active";
    }
  }
  if (currentLocation.includes("profile")) {
    $("#documen").addClass("menu-open");
  }
  if (
    currentLocation.includes("cuti") ||
    currentLocation.includes("aprovecuti")
  ) {
    $("#cuti").addClass("menu-open");
  }
  if (
    currentLocation.includes("daily") ||
    currentLocation.includes("approvement") ||
    currentLocation.includes("monthly") ||
    currentLocation.includes("Report")
  ) {
    $("#laporan").addClass("menu-open");
  }
  if (currentLocation.includes("helpdeskadmin") ||
    currentLocation.includes("contact")
  ) {
    $("#admin").addClass("menu-open");
  }

};

async function cekElemnet() {
  let elemnet = sessionStorage.getItem("elemnet");
  if (elemnet == null) {
    await $.ajax({
      url: "/api/contact/menu",
      method: "GET",
      success: function (data) {
        elemnet = encode(JSON.stringify(data.data));
        sessionStorage.setItem("elemnet", elemnet);
      },
    });
  };
  menuAkses();
  queryselec();
};
cekElemnet();


function menuAkses() {
  let elemnet = sessionStorage.getItem("elemnet");
  let parser = JSON.parse(decode(elemnet));
  let listPersetujuanCuti = $(`
    <ul class="nav nav-treeview">
      <li class="nav-item">
        <a href="/aprovecuti" class="nav-link">
         <i class="far fa-solid fa-bed nav-icon"></i>
         <p>Persetujuan Cuti</p>
        </a>
      </li>
    </ul>
  `);
  let listPersetujuanLPKP = $(`
  <li class="nav-item ">
    <a href="/approvement" class="nav-link">
        <i class="far fa-solid fa-file-contract nav-icon"></i>
        <p>Persetujuan Laporan</p>
    </a>
  </li>  `);
  let barAdmin = $(`
<li class="nav-item" id="admin" name="admin">
                    <a href="#" class="nav-link">
                        <i class="nav-icon fas fa-tachometer-alt"></i>
                        <p>
                            Menu Admin
                            <i class="right fas fa-angle-left"></i>
                        </p>
                    </a>
                    <ul class="nav nav-treeview"id="ul_admin" name="ul_admin" >
                    </ul>
</li>
`);
  let listcontact = $(`
        <li class="nav-item">
            <a href="/contact" class="nav-link">
                <i class="far fa-regular fa-address-book nav-icon"></i>
                <p>contact</p>
            </a>
        </li>
    `);
  let listadminhelpdesk = $(`
  <li class="nav-item">
  <a href="/helpdeskadmin" class="nav-link">
      <i class="far fa-solid fa-hand-holding-hand nav-icon"></i>
      <p>Admin Helpdesk</p>
  </a>
</li>
  `)
  if (parser[0].bos == true) {
    $("#cuti").append(listPersetujuanCuti);
    $("#ul_laporan").append(listPersetujuanLPKP);
  }
  let menu = parser[1].menu;
  if (menu.includes("admin")) {
    $("#navbar").append(barAdmin);
    if (menu.includes("contact")) {
      $("#ul_admin").append(listcontact)
    }
    if (menu.includes("helpdesk")) {
      $("#ul_admin").append(listadminhelpdesk)
    }

  }


  $("#navbar").append(`
<li class="nav-item" id="helpdesk" name="helpdesk">
    <a href="/helpdesk" class="nav-link">
        <i class="fa-solid fa-bug text-warning nav-icon"></i>
        <p class="text">Helpdesk</p>
    </a>
</li>
`)
  $("#navbar").append(`
<li class="nav-item">
    <a href="/logout" class="nav-link">
        <i class="fa-solid fa-right-from-bracket text-danger nav-icon"></i>
        <p class="text">Logout</p>
    </a>
</li>
    `);

}
